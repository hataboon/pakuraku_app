<div class="bg-gray-100 min-h-screen py-8">
  <div class="max-w-2xl mx-auto bg-white rounded-lg shadow p-8">
    <h2 class="text-2xl font-bold mb-6">プロフィール編集</h2>

    <%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put, class: "space-y-6", multipart: true }) do |f| %>
    <%= render "devise/shared/error_messages", resource: resource %>

    <%# アバター画像アップロード %>
    <div class="space-y-4">
      <div class="flex items-center space-x-4">
        <%# 現在のアバター画像を表示 %>
        <div class="w-24 h-24 rounded-full overflow-hidden bg-gray-100">
          <%= image_tag(current_user.avatar_thumbnail, class: "w-full h-full object-cover") if current_user.avatar.attached? %>
        </div>
        <%# アップロードフィールド %>
        <div>
          <%= f.label :avatar, "プロフィール画像", class: "block text-sm font-medium text-gray-700" %>
          <%= f.file_field :avatar, 
                class: "mt-1 block w-full text-sm text-gray-500
                        file:mr-4 file:py-2 file:px-4
                        file:rounded-full file:border-0
                        file:text-sm file:font-semibold
                        file:bg-indigo-50 file:text-indigo-700
                        hover:file:bg-indigo-100" %>
        </div>
      </div>
    </div>

    <%# ニックネーム %>
    <div>
      <%= f.label :nickname, "ニックネーム", class: "block text-sm font-medium text-gray-700" %>
      <%= f.text_field :nickname, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>

    <%# 既存のフィールド %>
    <div>
      <%= f.label :email, class: "block text-sm font-medium text-gray-700" %>
      <%= f.email_field :email, class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
    </div>

    <div>
      <%= f.label :password, class: "block text-sm font-medium text-gray-700" %>
      <%= f.password_field :password, autocomplete: "new-password", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      <% if @minimum_password_length %>
      <p class="mt-1 text-sm text-gray-500">※パスワードを変更しない場合は空白のままにしてください（<%= @minimum_password_length %>文字以上）</p>
      <% end %>
    </div>

    <div>
      <%= f.label :current_password, class: "block text-sm font-medium text-gray-700" %>
      <%= f.password_field :current_password, autocomplete: "current-password", class: "mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500" %>
      <p class="mt-1 text-sm text-gray-500">※変更を確認するために現在のパスワードが必要です</p>
    </div>

    <div class="flex justify-end">
      <%= f.submit "更新する", class: "px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500" %>
    </div>
    <% end %>

    <%# アカウント削除部分 %>
    <div class="mt-10 pt-6 border-t border-gray-200">
      <h3 class="text-lg font-medium text-gray-900">アカウント削除</h3>
      <div class="mt-2">
        <%= button_to "アカウントを削除する", registration_path(resource_name), 
            data: { confirm: "本当に削除しますか？", turbo_confirm: "本当に削除しますか？" }, 
            method: :delete, 
            class: "text-red-600 hover:text-red-700" %>
      </div>
    </div>
  </div>
</div>