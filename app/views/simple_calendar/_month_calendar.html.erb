<!-- views/simple_calendar/_month_calendar.html.erb -->
<div class="simple-calendar bg-white shadow rounded-lg p-6">
  <div class="calendar-heading flex justify-between items-center mb-4">
    <span class="calendar-title text-2xl font-bold text-gray-800">
      <%= "#{start_date.year}Âπ¥ #{t('date.month_names')[start_date.month]}" %>
    </span>

    <nav class="flex space-x-4">
      <%= link_to calendar.url_for_previous_view, class: 'p-2 bg-gray-100 rounded hover:bg-gray-200' do %>
      <span class="material-icons">arrow_back</span>
      <% end %>
      <%= link_to calendar.url_for_today_view, class: 'p-2 bg-gray-100 rounded hover:bg-gray-200' do %>
      <span class="material-icons">home</span>
      <% end %>
      <%= link_to calendar.url_for_next_view, class: 'p-2 bg-gray-100 rounded hover:bg-gray-200' do %>
      <span class="material-icons">arrow_forward</span>
      <% end %>
    </nav>
  </div>

  <table class="table-fixed w-full border-collapse">
    <thead>
      <tr>
        <% date_range.slice(0, 7).each do |day| %>
        <th class="p-2 bg-gray-200 text-center font-semibold text-gray-700">
          <%= t('date.abbr_day_names')[day.wday] %>
        </th>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% date_range.each_slice(7) do |week| %>
      <tr>
        <% week.each do |day| %>
        <td class="p-4 border border-gray-300 align-top bg-white hover:bg-gray-50">
          <div class="text-center font-bold text-lg mb-2 <%= day == Date.today ? 'text-blue-500' : '' %>">
            <%= day.day %>
          </div>

          <% plans_for_day = @calendar_plans&.select { |plan| plan.date == day } || [] %>

          <% { "Êúù" => "morning", "Êòº" => "afternoon", "Â§ú" => "evening" }.each do |label, meal_time| %>
          <% plan = plans_for_day.find { |p| p.meal_time == meal_time } %>
          <% if plan&.recipe&.name.present? %>
          <% names = plan.recipe.name.split(",") %>
          <% main = names[1] %>
          <% side = names[2] %>
          <div class="mb-2 p-2 bg-gray-50 rounded border border-gray-200 max-w-[200px] mx-auto">
            <div class="flex items-center justify-between">
              <div class="flex items-center">
                <%= check_box_tag "selected_dates[#{day.strftime('%Y-%m-%d')}][]", meal_time, false, class: "mr-2" %>
                <span><%= label %></span>
              </div>
              <% if plan && plan.user_id == current_user.id %>
              <%= link_to 'üóë', calendar_plan_path(plan.id), method: :delete, data: { confirm: "Êú¨ÂΩì„Å´ÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü" }, class: "text-red-500" %>
              <% end %>
            </div>
            <div class="mt-2 text-sm">
              <% if main %>
              <span class="text-gray-700">‰∏ªËèú: <%= main.strip %></span>
              <% end %>
              <% if side %>
              <span class="text-gray-600 ml-2">ÂâØËèú: <%= side.strip %></span>
              <% end %>
            </div>
          </div>
          <% end %>
          <% end %>
        </td>
        <% end %>
      </tr>
      <% end %>
    </tbody>
  </table>
</div>

<style>
  /* „Çπ„Éû„Éº„Éà„Éï„Ç©„É≥Áî®„É¨„Ç§„Ç¢„Ç¶„ÉàË™øÊï¥ */
  @media (max-width: 768px) {
    .simple-calendar table {
      font-size: 0.9rem;
    }

    .simple-calendar td {
      padding: 2px;
    }

    .simple-calendar .calendar-title {
      font-size: 1.5rem;
    }
  }
</style>