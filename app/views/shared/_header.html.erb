<!--shared/_header.html.erb -->
<header class="bg-gray-800">
  <div class="justify-between mx-auto max-w-7xl px-2 sm:px-6 lg:px-8">
    <div class="relative flex h-16 items-center justify-between">
      <div class="flex flex-1 items-center justify-start sm:items-stretch">
        <div class="flex flex-shrink-0 items-center">
          <%= link_to root_path do %>
          <img class="h-8 w-auto" src="https://tailwindui.com/plus/img/logos/mark.svg?color=indigo&shade=500" alt="Your Company">
          <% end %>
        </div>
      </div>
      <div class="flex items-center space-x-4">
        <!-- Navigation Links -->
        <%= link_to "栄養グラフ", nutritions_path, class: "rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white" %>
        <%= link_to "献立作成", new_recipe_path, class: "rounded-md px-3 py-2 text-sm font-medium text-gray-300 hover:bg-gray-700 hover:text-white" %>
        <!-- Register and Login Buttons -->
        <% if user_signed_in? %>
        <!-- ログアウトリンク（ログイン中のみ表示） -->
        <%= link_to "ログアウト", destroy_user_session_path, data: { turbo_method: :delete }, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %> <% else %>
        <!-- ログイン・新規登録リンク（未ログイン時のみ表示） -->
        <%= link_to "ログイン", new_user_session_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        <%= link_to "新規登録", new_user_registration_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" %>
        <% end %>
        <!-- Profile Icon for Dropdown -->
        <div class="relative ml-3">
          <!-- Profile Icon -->
          <button type="button" class="flex rounded-full items-center bg-gray-800 text-sm focus:outline-none focus:ring-2 focus:ring-white focus:ring-offset-2 focus:ring-offset-gray-800" id="user-menu-button" aria-expanded="false" aria-haspopup="true">
            <span class="sr-only">Open user menu</span>
            <img class="h-8 w-8 rounded-full" src="https://www.gravatar.com/avatar/?d=mp&s=200" alt="user photo">
          </button>
          <!-- Dropdown menu -->
          <div id="dropdownAvatar" class="hidden absolute right-0 z-10 mt-2 w-44 origin-top-right rounded-md bg-white py-1 shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none" role="menu" aria-orientation="vertical" aria-labelledby="user-menu-button" tabindex="-1">
            <% if user_signed_in? %>
            <!-- アカウント名 -->
            <div class="px-4 py-2 text-sm font-bold text-gray-800">
              <%= current_user.name || "ゲスト" %>
              <!-- current_user.name を適宜修正 -->
            </div>
            <!-- 区切り線 -->
            <div class="border-t border-gray-300"></div>
            <% end %>
            <!-- プロフィールリンク -->
            <a href="#" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100" role="menuitem" tabindex="-1" id="user-menu-item-0">プロフィール</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    const userMenuButton = document.getElementById('user-menu-button');
    const dropdownAvatar = document.getElementById('dropdownAvatar');

    // Toggle the dropdown menu when the button is clicked
    userMenuButton.addEventListener('click', function() {
      dropdownAvatar.classList.toggle('hidden');
    });

    // Close the dropdown if clicked outside
    document.addEventListener('click', function(event) {
      if (!userMenuButton.contains(event.target) && !dropdownAvatar.contains(event.target)) {
        dropdownAvatar.classList.add('hidden');
      }
    });
  });
</script>